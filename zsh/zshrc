# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

export EDITOR='nvim'
export LANG=en_US.UTF-8
export ANTIGEN_HOME=~/.antigen

# proxy
export socks_proxy="socks5://127.0.0.1:7890"

# we need to set this or pip is unhappy :(
export all_proxy="http:127.0.0.1:7890"

export GOPROXY=https://goproxy.cn
export GOPATH=$HOME/.go

# man-pages
export MANPAGER='bash -c "col -bx | batcat -pl man --theme=Monokai\ Extended"'
export MANROFFOPT='-c'

# alias
alias vim="nvim"
alias vi="nvim"
alias nj="ninja"
alias pc="proxychains"
alias tmn="tmux new -s"
alias tma="tmux attach -t"
alias tml="tmux list-sessions"
alias tmk="tmux kill-session -t"
alias cmk="cmake -G "Ninja" -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=YES ../"
# Download music from youtube
alias ytb-music="youtube-dl --ignore-errors --output '%(title)s.%(ext)s' --extract-audio --audio-format mp3"
# Play music with no gui
alias ffplay="ffplay -nodisp -autoexit"
# FIXME: This only work for Ubuntu.
alias open="xdg-open"

for dir in $(ls ~/opt); do
    PATH=~/opt/$dir/bin:$PATH
done

export PATH=$PATH:~/dev/depot_tools
if [ ! -d $ANTIGEN_HOME ]; then
    echo "antigen is not available, install it now..."
    mkdir ~/.antigen
    curl -L git.io/antigen > ~/.antigen/antigen.zsh
fi

source ~/.antigen/antigen.zsh

antigen use oh-my-zsh
antigen bundle vi-mode
antigen bundle git
antigen bundle fzf
antigen bundle zsh-users/zsh-autosuggestions
antigen bundle zsh-users/zsh-syntax-highlighting
antigen bundle romkatv/powerlevel10k
antigen theme romkatv/powerlevel10k
antigen apply

function work {
    if [[ -n "$TMUX" ]]
    then
        return 0
    fi
    tmux ls -F '#{session_name}' |
    fzf --bind=enter:replace-query+print-query |
    read session && tmux attach -t ${session:-default} || tmux new -s ${session:-default}
}

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
