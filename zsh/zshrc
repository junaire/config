export EDITOR='nvim'
export LANG=en_US.UTF-8

ANTIGEN_HOME=~/.antigen
USER_OPT_DIR=~/opt

# proxy
export socks_proxy="socks5://127.0.0.1:7890"

# we need to set this or pip is unhappy :(
export http_proxy="http://127.0.0.1:7890"
export https_proxy="https://127.0.0.1:7890"

export GOPROXY=https://goproxy.cn
export GOPATH=${HOME}/.go

# man-pages
export MANPAGER='bash -c "col -bx | batcat -pl man --theme=Monokai\ Extended"'
export MANROFFOPT='-c'

# alias
alias vim="nvim"
alias vi="nvim"
alias nj="ninja"
alias pc="proxychains"
alias tmn="tmux new -s"
alias tma="tmux attach -t"
alias tml="tmux list-sessions"
alias tmk="tmux kill-session -t"
alias cmk="cmake -G "Ninja" -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=YES ../"
# Download music from youtube
alias ytb-music="youtube-dl --ignore-errors --output '%(title)s.%(ext)s' --extract-audio --audio-format mp3"
# Play music with no gui
alias ffplay="ffplay -nodisp -autoexit"
# FIXME: This only work for Ubuntu.
alias open="xdg-open"

if [ ! -d ${USER_OPT_DIR} ]; then
    mkdir ${USER_OPT_DIR}
else
    for dir in $(ls ${USER_OPT_DIR}); do
        PATH=${USER_OPT_DIR}/${dir}/bin:${PATH}
    done
fi

export PATH=${PATH}:~/dev/depot_tools:~/.local/bin

if [ ! -d ${ANTIGEN_HOME} ]; then
    echo "antigen is not available, install it now..."
    mkdir ${ANTIGEN_HOME}
    curl -sL git.io/antigen > ${ANTIGEN_HOME}/antigen.zsh
fi

if [[ $(cat ${ANTIGEN_HOME}/antigen.zsh | wc -l) == 0 ]]; then
    echo "antigen failed to install!"
    rm -rf ${ANTIGEN_HOME}
    exit 1
else
    source ${ANTIGEN_HOME}/antigen.zsh
    antigen use oh-my-zsh
    antigen bundle vi-mode
    antigen bundle git
    antigen bundle fzf
    antigen bundle zsh-users/zsh-autosuggestions
    antigen bundle zsh-users/zsh-syntax-highlighting
    antigen bundle romkatv/powerlevel10k
    antigen theme romkatv/powerlevel10k
    antigen apply
fi

function work {
    if [[ -n "${TMUX}" ]]
    then
        return 0
    fi
    tmux ls -F '#{session_name}' |
    fzf --bind=enter:replace-query+print-query |
    read session && tmux attach -t ${session:-default} || tmux new -s ${session:-default}
}

function llvm-patch-apply() {
    curl -sL https://reviews.llvm.org/${1}\?download\=true | git apply -
}
